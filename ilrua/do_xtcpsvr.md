# 搭建XTCP服务
> 本章介绍了如何使用Miaofrp搭建XTCP服务

### 您必须要了解的知识
![XTcp](https://img.cncn3.cn/images/32Ky.png)

当电脑 A 想访问电脑 B 的某个服务时，电脑 B 上需要启动 服务隧道 准备接受连接

而电脑 A 需要启动 访问隧道，启动后电脑 A 会通过 MiaoFrp 请求与电脑 B 建立直接连接

> 由于国内网络环境极为复杂，中间可能隔了 N 个奇怪的路由，打洞很成功率极低

### 创建一个隧道

* 在侧栏选择创建隧道。
* 选择令您满意的Frp服务器

如果您面向中国东北地区，您可以选择海外节点“韩国首尔”。中国中部地区可以选择国内节点“大连电信”。中国南部地区可以选择“中国香港”

>您必须确定一个节点，它要同时被应用在另外一个节点上。

* 填写隧道名

```
服务隧道 的隧道名对下文有用。
访客隧道 的隧道名无关紧要
```
所以，填写第一个隧道的隧道名。这必须是一个易记牢的隧道名。

* 选择隧道类型

我们必须选择XTCP类型的隧道。

* 填写本地地址

此服务器创建在您的计算机上，您就需要输入127.0.0.1，客户端才能知道您需要映射本台计算机的某一端口。如果您需要给当前计算机配置内网穿透服务，就要填写127.0.0.1。


* 填写本地端口

填写您配置XTcp服务时用的端口。比如1234。

* 填写远程端口

填写的值要大于等于1024，小于等于65535。您可以挑选你喜欢的端口。如果出现了端口被占用的情况，说明您的好点子早被前人想到了，换一个端口。你也可以点击 `随机端口` 按钮让服务器给您提供随机端口（不会被占用）。

* 填写访问密码

可以留空，系统会自动生成一个访问密码。或者您也可以自定义一个访客密码。我们建议用```大小写字母+数字+符号```混合的、无逻辑性的密码，如```this.(time=eve){listen.brokenLiu}```（此夜曲中闻折柳）。服务器自己生成的密码在配置文件下，您在配置完后记得在侧栏打开”配置文件“栏目，找到您设置的隧道名的类，里面的变量```sk```的值就是系统自动生成的或您填写的密码。

### 创建访问隧道

此隧道没有太多要求。隧道名自定义。

* 配置节点（同第二步）

和服务隧道相同即可

* 填写本地端口

此处填写的 ```本地端口``` 会在访问服务时用到，在这个例子中：

使用电脑 A 访问 访问隧道->```本地地址(127.0.0.1):访问隧道->本地端口(6666)```
等于

访问电脑 B 的 服务隧道->```本地地址(127.0.0.1):服务隧道->本地端口(2333)```

所以填写本地的监听端口。

* 填写自定义设置

在```高级设置```目录下找到```自定义设置```的填空。输入

```
role = visitor
server_name = 服务隧道的隧道名
```

### 配置与启用

点击“完成创建”按钮。

在“配置文件”条目复制您的配置文件。

现在，前往电脑 B 启动**服务隧道**，即刚才创建的第一条隧道

然后在需要访问服务时前往电脑 A 启动 访问隧道。**请通过命令行开启一条 访问隧道 可以在多个设备上同时开启，无需重复创建**

此时，在电脑 A 上访问 127.0.0.1:6666 就能访问到电脑 B 上的服务了

注意:

1. 每次创建完映射或删除了映射之后配置文件都会发生变化，请在变更后及时更新您的配置文件。

2. 请勿泄露配置文件中 user 字段的内容，否则他人可以登录您的账号，截图注意打码。

3. 不过，如果真的泄露了，可以通过修改密码来解决，User 字段的内容也会随之更新。

在客户端的同级目录创建一个文本文档，命名为 frpc.ini 。
使用文本编辑器打开它
将复制的内容粘贴到里面并保存。

 **Windows客户端**
 
按照上面的方法储存好你的配置文件。
在客户端的目录里按住 Shift + 鼠标右键。
点击 “在此处打开命令提示符” 或 “在此处打开 PowerShell”。
输入命令 frpc.exe -c frpc.ini 并按下回车启动。
保持命令提示符窗口打开，不要关闭它，否则映射会中断。

### 日志
```nat hole connection make success ```说明打洞成功，可以正常连接

```get sid from ... error: read udp ...: i/o timeout ```说明打洞失败，请检查两边的 NAT 环境是否符合要求


> Write by ilrua,SakuraDocs
